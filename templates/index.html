<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATP: AI-driven Translation Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <style>
        :root {
            --primary-color: #10a37f;
            --primary-hover: #0d8a6a;
            --secondary-color: #f7f7f8;
            --text-primary: #202123;
            --text-secondary: #6e6e80;
            --border-color: #e5e5e5;
            --chat-user-bg: #10a37f;
            --chat-ai-bg: #ffffff;
            --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
            --glass-bg: rgba(255, 255, 255, 0.95);
            --gradient-bg: radial-gradient(circle at top left, #f0fdf9, #fff);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--gradient-bg);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 40px;
        }

        /* --- 加载动画 (优化版) --- */
        .loader-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f0fdf9 0%, #ffffff 50%, #f0fdf9 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        /* 粒子背景动画 */
        .loader-container::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(16, 163, 127, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: particleMove 20s linear infinite;
            opacity: 0.6;
        }

        @keyframes particleMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .loader-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            position: relative;
            z-index: 1;
            animation: contentFadeIn 0.8s ease-out;
        }

        @keyframes contentFadeIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .logo-svg {
            width: 180px;
            height: 180px;
            filter: drop-shadow(0 10px 30px rgba(16, 163, 127, 0.2));
            animation: logoFloat 3s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-15px) rotate(5deg);
            }
        }

        .greetings-container {
            height: 50px;
            position: relative;
            width: 280px;
            text-align: center;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .greeting {
            position: absolute;
            width: 100%;
            font-size: 28px;
            font-weight: 600;
            background: linear-gradient(135deg, #10a37f 0%, #0d8a6a 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            opacity: 0;
            transform: translateY(30px) scale(0.8);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 2px;
        }
        
        @keyframes greetingAnimation {
            0% {
                opacity: 0;
                transform: translateY(30px) scale(0.8);
            }
            15% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            85% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-30px) scale(0.8);
            }
        }

        /* 加载进度条 */
        .loader-progress {
            width: 200px;
            height: 3px;
            background: rgba(16, 163, 127, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .loader-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #10a37f 0%, #0d8a6a 100%);
            border-radius: 10px;
            width: 0%;
            animation: progressLoad 2.5s ease-out forwards;
            box-shadow: 0 0 10px rgba(16, 163, 127, 0.5);
        }

        @keyframes progressLoad {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        /* --- 头部样式 --- */
        header {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #10a37f 0%, #0d8a6a 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* --- 入口卡片样式 --- */
        .entry-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            max-width: 1000px;
            margin: 0 auto 50px;
            padding: 0 20px;
        }
        
        .entry-card {
            background: var(--glass-bg);
            border: 1px solid rgba(0,0,0,0.05);
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }
        
        .entry-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-color: rgba(16, 163, 127, 0.3);
        }
        
        .entry-card.active {
            border: 2px solid var(--primary-color);
            background: #f0fdf9;
        }

        .entry-icon {
            font-size: 48px;
            margin-bottom: 20px;
            background: #e6fffa;
            width: 80px;
            height: 80px;
            line-height: 80px;
            border-radius: 50%;
            margin-left: auto;
            margin-right: auto;
            color: var(--primary-color);
        }
        
        .entry-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .entry-desc {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        /* --- 主容器与布局 --- */
        .page-area {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            animation: fadeIn 0.4s ease-out;
        }
        
        .page-area.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(550px, 1fr));
            gap: 30px;
        }

        /* --- 通用面板样式 --- */
        .translation-section {
            background: #ffffff;
            border-radius: 24px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-primary);
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 18px;
            background: var(--primary-color);
            border-radius: 2px;
        }

        /* --- 表单元素优化 --- */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        select, input[type="text"], input[type="password"], textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            font-size: 0.95rem;
            font-family: inherit;
            color: var(--text-primary);
            background-color: #fff;
            transition: all 0.2s ease;
            appearance: none; /* 移除原生样式 */
        }
        
        /* 给 Select 添加自定义箭头 */
        .select-wrapper {
            position: relative;
        }
        .select-wrapper::after {
            content: '\f107';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(16, 163, 127, 0.1);
        }

        /* 自定义文件上传样式 */
        input[type="file"] {
            padding: 10px;
            border: 2px dashed #cbd5e1;
            background: #f8fafc;
            cursor: pointer;
        }
        input[type="file"]:hover {
            border-color: var(--primary-color);
            background: #f0fdf9;
        }

        button.btn-primary, button[type="submit"], .send-button {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px 24px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

        /* --- 温度滑块优化 --- */
        .temperature-slider-container {
            padding: 10px 0;
        }
        
        .temperature-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            outline: none;
        }
        
        .temperature-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.1s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .temperature-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        
        .temperature-marks {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* --- 交互翻译特定样式 --- */
        .interactive-container {
            display: flex;
            gap: 0; /* 使用 transform 动画，不需要 gap */
            position: relative;
            height: 600px;
            border: 1px solid var(--border-color);
            border-radius: 16px;
            overflow: hidden;
            background: #fff;
        }

        /* 左侧设置栏 */
        .interactive-settings {
            width: 300px;
            background: #f8fafc;
            border-right: 1px solid var(--border-color);
            padding: 20px;
            overflow-y: auto;
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
        }

        .interactive-settings::-webkit-scrollbar {
            width: 4px;
        }
        .interactive-settings::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 2px;
        }

        /* 右侧聊天区域 */
        .interactive-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #fff;
            position: relative;
        }

        /* 折叠按钮 */
        .settings-toggle {
            position: absolute;
            left: 300px; /* 初始位置在设置栏边缘 */
            top: 50%;
            transform: translateY(-50%);
            z-index: 100;
            width: 24px;
            height: 48px;
            background: #fff;
            border: 1px solid var(--border-color);
            border-left: none;
            border-radius: 0 8px 8px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .settings-toggle:hover {
            color: var(--primary-color);
            background: #f0fdf9;
        }

        /* 折叠状态 */
        .settings-collapsed .interactive-settings {
            margin-left: -300px;
        }

        .settings-collapsed .settings-toggle {
            left: 0;
        }

        /* --- 聊天气泡样式 --- */
        .chat-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            max-width: 85%;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 用户消息 */
        .message.user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-content {
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 0.95rem;
            line-height: 1.5;
            position: relative;
            word-wrap: break-word;
        }

        .user-message .message-content {
            background: var(--chat-user-bg);
            color: white;
            border-bottom-right-radius: 2px;
        }

        /* AI 消息 */
        .message.ai-message {
            align-self: flex-start;
        }

        .ai-message .message-content {
            background: #f1f5f9;
            color: var(--text-primary);
            border-bottom-left-radius: 2px;
            border: 1px solid #e2e8f0;
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 16px;
        }

        .user-avatar {
            background: #e2e8f0;
            color: #64748b;
        }

        .ai-avatar {
            background: rgba(16, 163, 127, 0.1);
            color: var(--primary-color);
        }

        .model-tag {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
            display: block;
            font-weight: 600;
        }
        
        .chat-input-area {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            background: #fff;
        }

        /* --- 状态和进度条 --- */
        .status {
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
            display: none;
        }
        .status.success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .status.error { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }

        .progress {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            margin-top: 20px;
            overflow: hidden;
            display: none;
        }
        .progress-fill {
            height: 100%;
            background: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .download-btn {
            display: inline-block;
            background: #fff;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin-top: 15px;
            transition: all 0.2s;
        }
        .download-btn:hover {
            background: #f0fdf9;
        }

        /* --- 新增：模式切换样式 --- */
        .mode-switch-container {
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
        }

        .mode-switch {
            display: inline-flex;
            background: #f1f5f9;
            border-radius: 12px;
            padding: 4px;
            gap: 4px;
        }

        .mode-btn {
            padding: 10px 24px;
            border: none;
            background: transparent;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mode-btn:hover {
            background: rgba(16, 163, 127, 0.1);
            color: var(--primary-color);
        }

        .mode-btn.active {
            background: #fff;
            color: var(--primary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }

        /* --- 配置区域 --- */
        .config-area {
            background: #f8fafc;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }

        .config-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        /* --- 多模型配置 --- */
        .models-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 16px;
        }

        .model-card {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            position: relative;
        }

        .model-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .model-card-title {
            font-weight: 600;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .remove-model-btn {
            background: #fee2e2;
            color: #991b1b;
            border: none;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .remove-model-btn:hover {
            background: #fecaca;
            transform: scale(1.05);
        }

        .add-model-btn {
            width: 100%;
            padding: 12px;
            background: #fff;
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-model-btn:hover:not(:disabled) {
            border-color: var(--primary-color);
            color: var(--primary-color);
            background: #f0fdf9;
        }

        .add-model-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .shared-config {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
        }

        /* --- 输入区域 --- */
        .input-area {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .input-area textarea {
            width: 100%;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 0.95rem;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 12px;
        }

        /* --- 结果展示区域 --- */
        .results-area {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 20px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .results-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .compare-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .compare-btn:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .results-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .result-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            transition: all 0.2s;
        }

        .result-card:hover {
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .result-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
        }

        .result-model-name {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.95rem;
        }

        .result-status {
            font-size: 0.85rem;
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: 500;
        }

        .result-status.loading {
            background: #fef3c7;
            color: #92400e;
        }

        .result-status.success {
            background: #dcfce7;
            color: #166534;
        }

        .result-status.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .result-content {
            color: var(--text-primary);
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* --- 横向比较弹窗 --- */
        .compare-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .compare-modal.active {
            display: flex;
        }

        .compare-modal-content {
            background: #fff;
            border-radius: 20px;
            width: 90%;
            max-width: 1400px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }

        .compare-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 1px solid #e2e8f0;
        }

        .compare-modal-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal-btn {
            background: #f1f5f9;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .close-modal-btn:hover {
            background: #fee2e2;
            color: #991b1b;
        }

        .compare-modal-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        .compare-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .compare-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
        }

        .compare-item-header {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.95rem;
        }

        .compare-item-content {
            color: var(--text-primary);
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.9rem;
        }

        /* --- AI译审页面样式 --- */
        .review-input-area {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .review-input-area textarea {
            width: 100%;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 0.95rem;
            font-family: inherit;
            resize: vertical;
        }

        .review-config-area {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .two-stage-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 20px;
        }

        .stage-card {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
        }

        .stage-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(16, 163, 127, 0.12);
            color: var(--primary-color);
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .prompt-engineering-card {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
        }

        .prompt-preview {
            background: #0f172a;
            color: #e2e8f0;
            border-radius: 10px;
            padding: 14px;
            font-size: 0.85rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .json-output {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            background: #0f172a;
            color: #e2e8f0;
            border-radius: 10px;
            padding: 16px;
            font-size: 0.85rem;
            white-space: pre-wrap;
            overflow-x: auto;
        }

        .config-section-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dual-models-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .dual-model-card {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
        }

        .dual-model-header {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .meeting-models-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 16px;
        }

        .expert-card {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
        }

        .expert-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
        }

        .expert-role-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #10a37f 0%, #0d8a6a 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .expert-config-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .review-action-area {
            text-align: center;
            margin-bottom: 30px;
        }

        .review-result-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .review-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e2e8f0;
        }

        .review-result-title {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .review-score {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #10a37f 0%, #0d8a6a 100%);
            color: white;
            padding: 6px 14px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
        }

        .review-content-section {
            margin-bottom: 16px;
        }

        .review-section-label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .review-section-content {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .dual-comparison-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .meeting-result-timeline {
            position: relative;
            padding-left: 30px;
            margin-top: 20px;
        }

        .meeting-result-timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, #10a37f 0%, #e2e8f0 100%);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 24px;
        }

        .timeline-dot {
            position: absolute;
            left: -24px;
            top: 8px;
            width: 12px;
            height: 12px;
            background: var(--primary-color);
            border-radius: 50%;
            border: 3px solid #fff;
            box-shadow: 0 0 0 2px #e2e8f0;
        }

        .timeline-content {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 8px;
        }

        .timeline-expert-name {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .timeline-opinion {
            color: var(--text-primary);
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .final-consensus-card {
            background: linear-gradient(135deg, #f0fdf9 0%, #dcfce7 100%);
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            padding: 20px;
            margin-top: 24px;
        }

        .consensus-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 12px;
        }

        .consensus-content {
            background: #fff;
            border-radius: 8px;
            padding: 14px;
            line-height: 1.6;
        }

        /* --- 响应式 --- */
        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
            .config-row { grid-template-columns: 1fr; }
            .compare-grid { grid-template-columns: 1fr; }
            .compare-modal-content { width: 95%; max-height: 90vh; }
            .dual-models-grid { grid-template-columns: 1fr; }
            .dual-comparison-grid { grid-template-columns: 1fr; }
            .expert-config-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="loader-container" id="loader">
        <div class="loader-content">
            <svg class="logo-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#10a37f;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#0d8a6a;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <circle cx="100" cy="100" r="40" fill="none" stroke="url(#logoGradient)" stroke-width="4">
                    <animate attributeName="r" from="40" to="50" dur="1.5s" repeatCount="indefinite" />
                    <animate attributeName="opacity" from="1" to="0" dur="1.5s" repeatCount="indefinite" />
                </circle>
                <circle cx="100" cy="100" r="30" fill="url(#logoGradient)" opacity="0.8">
                    <animate attributeName="r" values="28;32;28" dur="2s" repeatCount="indefinite" />
                </circle>
            </svg>
            <div class="greetings-container">
                <div class="greeting" data-lang="中文">你好</div>
                <div class="greeting" data-lang="英文">Hello</div>
                <div class="greeting" data-lang="日文">こんにちは</div>
                <div class="greeting" data-lang="韩文">안녕하세요</div>
                <div class="greeting" data-lang="法文">Bonjour</div>
            </div>
            <div class="loader-progress">
                <div class="loader-progress-bar"></div>
            </div>
        </div>
    </div>

    <header>
        <h1>ATP</h1>
        <div class="subtitle">AI-driven Translation Platform</div>
    </header>
    
    <div class="entry-container" id="entryContainer" style="display: none; opacity: 0; transition: opacity 0.5s;">
        <div class="entry-card" data-page="interactive">
            <div class="entry-icon"><i class="fas fa-comments"></i></div>
            <div class="entry-title">交互翻译</div>
            <div class="entry-desc">实时多模型对话式翻译与润色</div>
        </div>
        <div class="entry-card" data-page="ai-translation">
            <div class="entry-icon"><i class="fas fa-file-alt"></i></div>
            <div class="entry-title">文档翻译</div>
            <div class="entry-desc">支持 Word/TXT 文档长文本处理</div>
        </div>
        <div class="entry-card" data-page="ai-review">
            <div class="entry-icon"><i class="fas fa-check-double"></i></div>
            <div class="entry-title">AI 译审</div>
            <div class="entry-desc">智能化翻译质量审核与改进</div>
        </div>
    </div>

    <div class="page-area" id="interactivePage">
        <div class="translation-section" style="max-width: 1200px; margin: 0 auto;">
            <h2 class="section-title"><i class="fas fa-comments"></i> 交互翻译</h2>

            <!-- 模式切换 -->
            <div class="mode-switch-container">
                <div class="mode-switch">
                    <button class="mode-btn active" data-mode="single">
                        <i class="fas fa-robot"></i> 单模型翻译
                    </button>
                    <button class="mode-btn" data-mode="multi">
                        <i class="fas fa-layer-group"></i> 多模型翻译
                    </button>
                </div>
            </div>

            <!-- 配置区域 -->
            <div class="config-area">
                <!-- 单模型配置 -->
                <div class="single-model-config" id="singleModelConfig">
                    <div class="config-row">
                        <div class="form-group select-wrapper">
                            <label><i class="fas fa-network-wired"></i> 选择API</label>
                            <select id="single_api_type" required>
                                <option value="deepseek">Deepseek</option>
                                <option value="openai">OpenAI</option>
                                <option value="anthropic">Anthropic</option>
                                <option value="google">Google</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-key"></i> API密钥</label>
                            <input type="password" id="single_api_key" required placeholder="sk-...">
                        </div>
                        <div class="form-group select-wrapper">
                            <label><i class="fas fa-robot"></i> 选择模型</label>
                            <select id="single_model" required>
                                <option value="deepseek-chat" data-api="deepseek">Deepseek Chat</option>
                                <option value="deepseek-reasoner" data-api="deepseek">Deepseek Reasoner</option>
                                <option value="gpt-4o" data-api="openai">GPT-4</option>
                                <option value="gpt-4.5-preview" data-api="openai">GPT-4.5 Preview</option>
                                <option value="claude-3.7-sonnet-20250219" data-api="anthropic">Claude 3.7 Sonnet</option>
                                <option value="gemini-pro" data-api="google">Gemini Pro</option>
                            </select>
                        </div>
                    </div>
                    <div class="config-row">
                        <div class="form-group">
                            <label>温度: <span id="single_temperature_value">1.0</span></label>
                            <div class="temperature-slider-container">
                                <input type="range" id="single_temperature" min="0" max="2" step="0.1" value="1.0" class="temperature-slider">
                                <div class="temperature-marks"><span>0</span><span>1.0</span><span>2.0</span></div>
                            </div>
                        </div>
                        <div class="form-group select-wrapper">
                            <label>源语言</label>
                            <select id="single_source_lang">
                                <option value="英文">英文</option>
                                <option value="中文">中文</option>
                                <option value="日文">日文</option>
                                <option value="韩文">韩文</option>
                            </select>
                        </div>
                        <div class="form-group select-wrapper">
                            <label>目标语言</label>
                            <select id="single_target_lang">
                                <option value="中文">中文</option>
                                <option value="英文">英文</option>
                                <option value="日文">日文</option>
                                <option value="韩文">韩文</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>系统提示词（可选）</label>
                        <textarea id="single_system_prompt" rows="2" placeholder="例如：你是一个专业的法律翻译..."></textarea>
                    </div>
                </div>

                <!-- 多模型配置 -->
                <div class="multi-model-config" id="multiModelConfig" style="display: none;">
                    <div class="models-container" id="modelsContainer">
                        <!-- 动态添加的模型配置 -->
                    </div>
                    <button class="add-model-btn" id="addModelBtn">
                        <i class="fas fa-plus"></i> 添加模型（最多3个）
                    </button>
                    <div class="shared-config">
                        <div class="config-row">
                            <div class="form-group select-wrapper">
                                <label>源语言</label>
                                <select id="multi_source_lang">
                                    <option value="英文">英文</option>
                                    <option value="中文">中文</option>
                                    <option value="日文">日文</option>
                                    <option value="韩文">韩文</option>
                                </select>
                            </div>
                            <div class="form-group select-wrapper">
                                <label>目标语言</label>
                                <select id="multi_target_lang">
                                    <option value="中文">中文</option>
                                    <option value="英文">英文</option>
                                    <option value="日文">日文</option>
                                    <option value="韩文">韩文</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>系统提示词（可选）</label>
                            <textarea id="multi_system_prompt" rows="2" placeholder="例如：你是一个专业的法律翻译..."></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 输入区域 -->
            <div class="input-area">
                <textarea id="user_input" rows="4" placeholder="输入需要翻译的内容..."></textarea>
                <button type="button" id="translateBtn" class="send-button">
                    <i class="fas fa-paper-plane"></i> 翻译
                </button>
            </div>

            <!-- 结果展示区域 -->
            <div class="results-area" id="resultsArea" style="display: none;">
                <div class="results-header">
                    <h3><i class="fas fa-list-check"></i> 翻译结果</h3>
                    <button class="compare-btn" id="compareBtn" style="display: none;">
                        <i class="fas fa-columns"></i> 横向比较
                    </button>
                </div>
                <div class="results-list" id="resultsList">
                    <!-- 动态添加的结果卡片 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 横向比较弹窗 -->
    <div class="compare-modal" id="compareModal">
        <div class="compare-modal-content">
            <div class="compare-modal-header">
                <h3><i class="fas fa-columns"></i> 横向比较翻译结果</h3>
                <button class="close-modal-btn" id="closeModalBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="compare-modal-body" id="compareModalBody">
                <!-- 动态添加的横向比较内容 -->
            </div>
        </div>
    </div>

    <div class="page-area" id="aiTranslationPage">
        <div class="container">
            <div class="translation-section">
                <h2 class="section-title"><i class="fas fa-file-upload"></i> 文档翻译 1</h2>
                <form id="translationForm1">
                    <div class="form-group">
                        <label for="file1">上传文档 (.txt, .doc, .docx)</label>
                        <input type="file" id="file1" name="file" accept=".txt,.doc,.docx" required>
                    </div>
                    
                    <div class="form-group select-wrapper">
                        <label>选择API</label>
                        <select id="api_type1" name="api_type" required>
                            <option value="deepseek">Deepseek</option>
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Anthropic</option>
                            <option value="google">Google</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>API密钥</label>
                        <input type="password" id="api_key1" name="api_key" required placeholder="输入您的 API Key">
                    </div>
                    
                    <div class="form-group select-wrapper">
                        <label>选择模型</label>
                        <select id="model1" name="model" required>
                            <option value="deepseek-chat" data-api="deepseek">Deepseek Chat</option>
                            <option value="deepseek-reasoner" data-api="deepseek">Deepseek Reasoner</option>
                            <option value="gpt-4o" data-api="openai">GPT-4</option>
                            <option value="gpt-4.5-preview" data-api="openai">GPT-4.5 Preview</option>
                            <option value="claude-3.7-sonnet-20250219" data-api="anthropic">Claude 3.7 Sonnet</option>
                            <option value="gemini-pro" data-api="google">Gemini Pro</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>温度: <span id="temperature-value1">1.0</span></label>
                        <div class="temperature-slider-container">
                            <input type="range" id="temperature1" name="temperature" min="0" max="2" step="0.1" value="1.0" class="temperature-slider">
                            <div class="temperature-marks"><span>0</span><span>1.0</span><span>2.0</span></div>
                        </div>
                    </div>
                    
                    <div class="form-group select-wrapper">
                        <label>源语言</label>
                        <select id="source_lang1" name="source_lang" required>
                            <option value="英文">英文</option><option value="中文">中文</option><option value="日文">日文</option><option value="韩文">韩文</option><option value="德文">德文</option><option value="法文">法文</option><option value="西班牙文">西班牙文</option><option value="俄文">俄文</option>
                        </select>
                    </div>
                    <div class="form-group select-wrapper">
                        <label>目标语言</label>
                        <select id="target_lang1" name="target_lang" required>
                            <option value="中文">中文</option><option value="英文">英文</option><option value="日文">日文</option><option value="韩文">韩文</option><option value="德文">德文</option><option value="法文">法文</option><option value="西班牙文">西班牙文</option><option value="俄文">俄文</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>系统提示词 (可选)</label>
                        <textarea id="system_prompt1" name="system_prompt" rows="3" placeholder="定义翻译风格..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>用户提示词 (可选)</label>
                        <textarea id="user_prompt1" name="user_prompt" rows="3" placeholder="额外的翻译要求..."></textarea>
                    </div>
                    
                    <button type="submit" id="submitBtn1"><i class="fas fa-play"></i> 开始翻译</button>
                </form>
                
                <div id="status1" class="status"></div>
                <div class="progress" id="progress1">
                    <div class="progress-bar" style="width:100%; height:8px; background:#e2e8f0; border-radius:4px;">
                        <div class="progress-fill"></div>
                    </div>
                </div>
                <div class="download-section" id="downloadSection1"></div>
            </div>

            <div class="translation-section">
                <h2 class="section-title"><i class="fas fa-file-upload"></i> 文档翻译 2</h2>
                <form id="translationForm2">
                    <div class="form-group">
                        <label for="file2">上传文档 (.txt, .doc, .docx)</label>
                        <input type="file" id="file2" name="file" accept=".txt,.doc,.docx" required>
                    </div>
                    <div class="form-group select-wrapper">
                        <label>选择API</label>
                        <select id="api_type2" name="api_type" required>
                            <option value="deepseek">Deepseek</option>
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Anthropic</option>
                            <option value="google">Google</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>API密钥</label>
                        <input type="password" id="api_key2" name="api_key" required placeholder="输入您的 API Key">
                    </div>
                    <div class="form-group select-wrapper">
                        <label>选择模型</label>
                        <select id="model2" name="model" required>
                            <option value="deepseek-chat" data-api="deepseek">Deepseek Chat</option>
                            <option value="deepseek-reasoner" data-api="deepseek">Deepseek Reasoner</option>
                            <option value="gpt-4o" data-api="openai">GPT-4</option>
                            <option value="gpt-4.5-preview" data-api="openai">GPT-4.5 Preview</option>
                            <option value="claude-3.7-sonnet-20250219" data-api="anthropic">Claude 3.7 Sonnet</option>
                            <option value="gemini-pro" data-api="google">Gemini Pro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>温度: <span id="temperature-value2">1.0</span></label>
                        <div class="temperature-slider-container">
                            <input type="range" id="temperature2" name="temperature" min="0" max="2" step="0.1" value="1.0" class="temperature-slider">
                            <div class="temperature-marks"><span>0</span><span>1.0</span><span>2.0</span></div>
                        </div>
                    </div>
                    <div class="form-group select-wrapper">
                        <label>源语言</label>
                        <select id="source_lang2" name="source_lang" required>
                            <option value="英文">英文</option><option value="中文">中文</option><option value="日文">日文</option><option value="韩文">韩文</option><option value="德文">德文</option><option value="法文">法文</option><option value="西班牙文">西班牙文</option><option value="俄文">俄文</option>
                        </select>
                    </div>
                    <div class="form-group select-wrapper">
                        <label>目标语言</label>
                        <select id="target_lang2" name="target_lang" required>
                            <option value="中文">中文</option><option value="英文">英文</option><option value="日文">日文</option><option value="韩文">韩文</option><option value="德文">德文</option><option value="法文">法文</option><option value="西班牙文">西班牙文</option><option value="俄文">俄文</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>系统提示词 (可选)</label>
                        <textarea id="system_prompt2" name="system_prompt" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>用户提示词 (可选)</label>
                        <textarea id="user_prompt2" name="user_prompt" rows="3"></textarea>
                    </div>
                    <button type="submit" id="submitBtn2"><i class="fas fa-play"></i> 开始翻译</button>
                </form>
                <div id="status2" class="status"></div>
                <div class="progress" id="progress2">
                    <div class="progress-bar" style="width:100%; height:8px; background:#e2e8f0; border-radius:4px;">
                        <div class="progress-fill"></div>
                    </div>
                </div>
                <div class="download-section" id="downloadSection2"></div>
            </div>
        </div>
    </div>

    <div class="page-area" id="aiReviewPage">
        <div class="translation-section" style="max-width: 1200px; margin: 0 auto;">
            <h2 class="section-title"><i class="fas fa-check-double"></i> AI 译审</h2>

            <!-- 模式切换 -->
            <div class="mode-switch-container">
                <div class="mode-switch" style="gap: 4px;">
                    <button class="mode-btn active" data-review-mode="single">
                        <i class="fas fa-user-check"></i> 单模型译审
                    </button>
                    <button class="mode-btn" data-review-mode="dual">
                        <i class="fas fa-user-friends"></i> 双模型对比
                    </button>
                    <button class="mode-btn" data-review-mode="two-stage">
                        <i class="fas fa-layer-group"></i> 双阶段协同
                    </button>
                    <button class="mode-btn" data-review-mode="meeting">
                        <i class="fas fa-users"></i> 模型开会
                    </button>
                </div>
            </div>

            <!-- 输入区域 -->
            <div class="review-input-area">
                <div class="form-group">
                    <label><i class="fas fa-file-alt"></i> 原文</label>
                    <textarea id="review_source_text" rows="4" placeholder="输入原文内容..."></textarea>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-language"></i> 译文</label>
                    <textarea id="review_target_text" rows="4" placeholder="输入译文内容..."></textarea>
                </div>
                <div class="config-row" style="margin-top: 12px;">
                    <div class="form-group select-wrapper">
                        <label>源语言</label>
                        <select id="review_source_lang">
                            <option value="英文">英文</option>
                            <option value="中文">中文</option>
                            <option value="日文">日文</option>
                            <option value="韩文">韩文</option>
                        </select>
                    </div>
                    <div class="form-group select-wrapper">
                        <label>目标语言</label>
                        <select id="review_target_lang">
                            <option value="中文">中文</option>
                            <option value="英文">英文</option>
                            <option value="日文">日文</option>
                            <option value="韩文">韩文</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 单模型配置 -->
            <div class="review-config-area" id="singleReviewConfig">
                <h3 class="config-section-title"><i class="fas fa-cog"></i> 模型配置</h3>
                <div class="config-row">
                    <div class="form-group select-wrapper">
                        <label><i class="fas fa-network-wired"></i> 选择API</label>
                        <select id="review_single_api_type">
                            <option value="deepseek">Deepseek</option>
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Anthropic</option>
                            <option value="google">Google</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-key"></i> API密钥</label>
                        <input type="password" id="review_single_api_key" placeholder="sk-...">
                    </div>
                    <div class="form-group select-wrapper">
                        <label><i class="fas fa-robot"></i> 选择模型</label>
                        <select id="review_single_model">
                            <option value="deepseek-chat" data-api="deepseek">Deepseek Chat</option>
                            <option value="deepseek-reasoner" data-api="deepseek">Deepseek Reasoner</option>
                            <option value="gpt-4o" data-api="openai">GPT-4</option>
                            <option value="gpt-4.5-preview" data-api="openai">GPT-4.5 Preview</option>
                            <option value="claude-3.7-sonnet-20250219" data-api="anthropic">Claude 3.7 Sonnet</option>
                            <option value="gemini-pro" data-api="google">Gemini Pro</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 双模型配置 -->
            <div class="review-config-area" id="dualReviewConfig" style="display: none;">
                <h3 class="config-section-title"><i class="fas fa-cog"></i> 模型配置</h3>
                <div class="dual-models-grid">
                    <!-- 模型1 -->
                    <div class="dual-model-card">
                        <div class="dual-model-header">
                            <i class="fas fa-robot"></i> 模型 1
                        </div>
                        <div class="form-group select-wrapper">
                            <label>选择API</label>
                            <select id="review_dual_api_type1">
                                <option value="deepseek">Deepseek</option>
                                <option value="openai">OpenAI</option>
                                <option value="anthropic">Anthropic</option>
                                <option value="google">Google</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>API密钥</label>
                            <input type="password" id="review_dual_api_key1" placeholder="sk-...">
                        </div>
                        <div class="form-group select-wrapper">
                            <label>选择模型</label>
                            <select id="review_dual_model1">
                                <option value="deepseek-chat" data-api="deepseek">Deepseek Chat</option>
                                <option value="deepseek-reasoner" data-api="deepseek">Deepseek Reasoner</option>
                                <option value="gpt-4o" data-api="openai">GPT-4</option>
                                <option value="gpt-4.5-preview" data-api="openai">GPT-4.5 Preview</option>
                                <option value="claude-3.7-sonnet-20250219" data-api="anthropic">Claude 3.7 Sonnet</option>
                                <option value="gemini-pro" data-api="google">Gemini Pro</option>
                            </select>
                        </div>
                    </div>
                    <!-- 模型2 -->
                    <div class="dual-model-card">
                        <div class="dual-model-header">
                            <i class="fas fa-robot"></i> 模型 2
                        </div>
                        <div class="form-group select-wrapper">
                            <label>选择API</label>
                            <select id="review_dual_api_type2">
                                <option value="deepseek">Deepseek</option>
                                <option value="openai">OpenAI</option>
                                <option value="anthropic">Anthropic</option>
                                <option value="google">Google</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>API密钥</label>
                            <input type="password" id="review_dual_api_key2" placeholder="sk-...">
                        </div>
                        <div class="form-group select-wrapper">
                            <label>选择模型</label>
                            <select id="review_dual_model2">
                                <option value="deepseek-chat" data-api="deepseek">Deepseek Chat</option>
                                <option value="deepseek-reasoner" data-api="deepseek">Deepseek Reasoner</option>
                                <option value="gpt-4o" data-api="openai">GPT-4</option>
                                <option value="gpt-4.5-preview" data-api="openai">GPT-4.5 Preview</option>
                                <option value="claude-3.7-sonnet-20250219" data-api="anthropic">Claude 3.7 Sonnet</option>
                                <option value="gemini-pro" data-api="google">Gemini Pro</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 双阶段配置 -->
            <div class="review-config-area" id="twoStageReviewConfig" style="display: none;">
                <h3 class="config-section-title"><i class="fas fa-layer-group"></i> 双阶段推理与人机协同配置</h3>
                <div class="two-stage-grid">
                    <div class="stage-card">
                        <div class="stage-badge"><i class="fas fa-bolt"></i> 初筛扫描（快速模型）</div>
                        <div class="form-group select-wrapper">
                            <label>选择API</label>
                            <select id="review_scan_api_type">
                                <option value="deepseek">Deepseek</option>
                                <option value="openai">OpenAI</option>
                                <option value="anthropic">Anthropic</option>
                                <option value="google">Google</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>API密钥</label>
                            <input type="password" id="review_scan_api_key" placeholder="sk-...">
                        </div>
                        <div class="form-group select-wrapper">
                            <label>选择模型</label>
                            <select id="review_scan_model">
                                <option value="deepseek-chat" data-api="deepseek">Deepseek Chat</option>
                                <option value="deepseek-reasoner" data-api="deepseek">Deepseek Reasoner</option>
                                <option value="gpt-4o" data-api="openai">GPT-4</option>
                                <option value="gpt-5.2" data-api="openai">GPT-5.2</option>
                                <option value="gpt-4.5-preview" data-api="openai">GPT-4.5 Preview</option>
                                <option value="claude-3.7-sonnet-20250219" data-api="anthropic">Claude 3.7 Sonnet</option>
                                <option value="gemini-3-fast" data-api="google">Gemini 3 Fast</option>
                                <option value="gemini-pro" data-api="google">Gemini Pro</option>
                            </select>
                        </div>
                    </div>
                    <div class="stage-card">
                        <div class="stage-badge"><i class="fas fa-brain"></i> 深度校准（推理模型）</div>
                        <div class="form-group select-wrapper">
                            <label>选择API</label>
                            <select id="review_calibration_api_type">
                                <option value="deepseek">Deepseek</option>
                                <option value="openai">OpenAI</option>
                                <option value="anthropic">Anthropic</option>
                                <option value="google">Google</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>API密钥</label>
                            <input type="password" id="review_calibration_api_key" placeholder="sk-...">
                        </div>
                        <div class="form-group select-wrapper">
                            <label>选择模型</label>
                            <select id="review_calibration_model">
                                <option value="deepseek-reasoner" data-api="deepseek">Deepseek Reasoner</option>
                                <option value="deepseek-chat" data-api="deepseek">Deepseek Chat</option>
                                <option value="gpt-4o" data-api="openai">GPT-4</option>
                                <option value="gpt-5.2-thinking" data-api="openai">GPT-5.2 Thinking</option>
                                <option value="gpt-4.5-preview" data-api="openai">GPT-4.5 Preview</option>
                                <option value="claude-3.7-sonnet-20250219" data-api="anthropic">Claude 3.7 Sonnet</option>
                                <option value="gemini-3-pro" data-api="google">Gemini 3 Pro</option>
                                <option value="gemini-pro" data-api="google">Gemini Pro</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="prompt-engineering-card">
                    <div class="config-section-title"><i class="fas fa-wand-magic-sparkles"></i> 动态提示词工程</div>
                    <div class="config-row">
                        <div class="form-group select-wrapper">
                            <label>体裁类型</label>
                            <select id="review_genre">
                                <option value="通用">通用</option>
                                <option value="法律">法律</option>
                                <option value="医学">医学</option>
                                <option value="文学">文学</option>
                                <option value="科技">科技</option>
                                <option value="市场营销">市场营销</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>人类关注点（可选）</label>
                            <input type="text" id="review_human_notes" placeholder="例如：重点关注术语一致性/法规引用">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Few-shot 示例（可编辑）</label>
                        <textarea id="review_few_shot" rows="6" placeholder="这里会根据体裁自动注入Few-shot示例"></textarea>
                    </div>
                    <div class="form-group">
                        <label>结构化JSON输出预览</label>
                        <div class="prompt-preview" id="review_prompt_preview"></div>
                    </div>
                </div>
            </div>

            <!-- 模型开会配置 -->
            <div class="review-config-area" id="meetingReviewConfig" style="display: none;">
                <h3 class="config-section-title"><i class="fas fa-users-cog"></i> 专家团队配置（至少3个）</h3>
                <div class="meeting-models-container" id="meetingModelsContainer">
                    <!-- 动态添加的专家配置 -->
                </div>
                <button class="add-model-btn" id="addExpertBtn">
                    <i class="fas fa-user-plus"></i> 添加专家
                </button>
            </div>

            <!-- 开始译审按钮 -->
            <div class="review-action-area">
                <button type="button" id="startReviewBtn" class="send-button">
                    <i class="fas fa-play"></i> 开始译审
                </button>
            </div>

            <!-- 结果展示区域 -->
            <div class="results-area" id="reviewResultsArea" style="display: none;">
                <div class="results-header">
                    <h3><i class="fas fa-clipboard-check"></i> 译审结果</h3>
                </div>
                <div id="reviewResultsContent">
                    <!-- 动态添加的结果内容 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // 页面加载完成后显示入口选择，隐藏加载动画
        window.addEventListener('load', function() {
            // 设置问候语动画
            const greetings = document.querySelectorAll('.greeting');
            const animationDuration = 3000; // 增加总时长使动画更流畅
            const segmentDuration = animationDuration / greetings.length;
            
            greetings.forEach((greeting, index) => {
                greeting.style.animation = `greetingAnimation ${segmentDuration}ms cubic-bezier(0.4, 0, 0.2, 1) forwards`;
                greeting.style.animationDelay = `${index * segmentDuration}ms`;
            });
            
            const loader = document.getElementById('loader');
            const entryContainer = document.getElementById('entryContainer');
            
            // 延迟显示入口选择，让动画完整播放
            setTimeout(() => {
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                    // 显示入口选择并添加淡入动画
                    entryContainer.style.display = 'grid';
                    // 强制重绘以触发 transition
                    entryContainer.offsetHeight; 
                    entryContainer.style.opacity = '1';
                    
                    // 为入口卡片添加依次出现的动画
                    const cards = entryContainer.querySelectorAll('.entry-card');
                    cards.forEach((card, index) => {
                        card.style.opacity = '0';
                        card.style.transform = 'translateY(20px)';
                        setTimeout(() => {
                            card.style.transition = 'all 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
                            card.style.opacity = '1';
                            card.style.transform = 'translateY(0)';
                        }, index * 100);
                    });
                }, 800);
            }, 3000);
        });

        // 入口选择处理
        const entryCards = document.querySelectorAll('.entry-card');
        entryCards.forEach(card => {
            card.addEventListener('click', function() {
                const pageId = this.getAttribute('data-page');
                showPage(pageId);
            });
        });
        
        // 显示页面函数
        function showPage(pageId) {
            // 隐藏所有页面
            document.querySelectorAll('.page-area').forEach(page => {
                page.classList.remove('active');
            });
            
            // 显示选定页面
            let pageToShow;
            switch(pageId) {
                case 'interactive':
                    pageToShow = document.getElementById('interactivePage');
                    break;
                case 'ai-translation':
                    pageToShow = document.getElementById('aiTranslationPage');
                    break;
                case 'ai-review':
                    pageToShow = document.getElementById('aiReviewPage');
                    break;
            }
            
            if (pageToShow) {
                pageToShow.classList.add('active');
                // 滚动到页面区域，防止被头部遮挡
                pageToShow.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            // 高亮选中的入口卡片
            entryCards.forEach(card => {
                if (card.getAttribute('data-page') === pageId) {
                    card.classList.add('active');
                } else {
                    card.classList.remove('active');
                }
            });
        }

        // 更新模型选项的函数
        function updateModelOptions(apiType, modelSelect) {
            const options = modelSelect.getElementsByTagName('option');
            let firstVisible = null;
            
            for (let option of options) {
                if (option.getAttribute('data-api') === apiType) {
                    option.style.display = '';
                    if (!firstVisible) firstVisible = option;
                } else {
                    option.style.display = 'none';
                }
            }
            // 只有当当前选中的选项不可见时，才切换到第一个可见选项
            if (modelSelect.selectedOptions.length > 0 && modelSelect.selectedOptions[0].style.display === 'none') {
                if (firstVisible) firstVisible.selected = true;
            } else if (modelSelect.selectedIndex === -1 && firstVisible) {
                 firstVisible.selected = true;
            }
        }

        // 为两个区域的API选择添加事件监听器
        document.getElementById('api_type1').addEventListener('change', function() {
            updateModelOptions(this.value, document.getElementById('model1'));
        });

        document.getElementById('api_type2').addEventListener('change', function() {
            updateModelOptions(this.value, document.getElementById('model2'));
        });

        // 初始化模型选项
        updateModelOptions('deepseek', document.getElementById('model1'));
        updateModelOptions('deepseek', document.getElementById('model2'));

        // 处理表单提交的函数 (保持原逻辑)
        function handleSubmit(formId, statusId, progressId, downloadSectionId) {
            const form = document.getElementById(formId);
            const status = document.getElementById(statusId);
            const progress = document.getElementById(progressId);
            const progressFill = progress.querySelector('.progress-fill');
            const downloadSection = document.getElementById(downloadSectionId);
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                status.style.display = 'none';
                progress.style.display = 'block';
                progressFill.style.width = '30%'; // 模拟初始进度
                downloadSection.innerHTML = '';
                
                // 改变按钮状态
                const btn = form.querySelector('button[type="submit"]');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 处理中...';
                btn.disabled = true;

                try {
                    const response = await fetch('/upload', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    progressFill.style.width = '100%';
                    
                    if (result.error) {
                        status.textContent = result.error;
                        status.className = 'status error';
                        status.style.display = 'block';
                    } else {
                        status.textContent = result.message;
                        status.className = 'status success';
                        status.style.display = 'block';
                        
                        // 显示下载按钮
                        const downloadBtn = document.createElement('a');
                        downloadBtn.href = `/download/${result.output_file}`;
                        downloadBtn.className = 'download-btn';
                        downloadBtn.innerHTML = '<i class="fas fa-download"></i> 下载翻译结果';
                        downloadSection.appendChild(downloadBtn);
                    }
                } catch (error) {
                    status.textContent = '翻译过程中发生错误，请重试';
                    status.className = 'status error';
                    status.style.display = 'block';
                } finally {
                    setTimeout(() => { 
                         progress.style.display = 'none'; 
                         progressFill.style.width = '0%';
                    }, 2000);
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            });
        }

        // 为两个表单添加提交处理
        handleSubmit('translationForm1', 'status1', 'progress1', 'downloadSection1');
        handleSubmit('translationForm2', 'status2', 'progress2', 'downloadSection2');

        // 交互翻译页面功能 - 重构版
        document.addEventListener('DOMContentLoaded', function() {
            // 温度滑块功能
            function setupSlider(sliderId, valueId) {
                const slider = document.getElementById(sliderId);
                const valueDisplay = document.getElementById(valueId);
                if (slider && valueDisplay) {
                    slider.addEventListener('input', function() {
                        valueDisplay.textContent = this.value;
                    });
                }
            }

            setupSlider('single_temperature', 'single_temperature_value');
            setupSlider('temperature1', 'temperature-value1');
            setupSlider('temperature2', 'temperature-value2');

            // 全局变量
            let currentMode = 'single'; // single 或 multi
            let modelCounter = 0;
            let translationResults = [];

            // 模式切换
            const modeBtns = document.querySelectorAll('.mode-btn');
            const singleModelConfig = document.getElementById('singleModelConfig');
            const multiModelConfig = document.getElementById('multiModelConfig');

            modeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const mode = this.getAttribute('data-mode');
                    currentMode = mode;

                    modeBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    if (mode === 'single') {
                        singleModelConfig.style.display = 'block';
                        multiModelConfig.style.display = 'none';
                    } else {
                        singleModelConfig.style.display = 'none';
                        multiModelConfig.style.display = 'block';
                        // 如果没有模型配置，自动添加一个
                        if (document.querySelectorAll('.model-card').length === 0) {
                            addModelCard();
                        }
                    }
                });
            });

            // 单模型API联动
            const singleApiType = document.getElementById('single_api_type');
            const singleModel = document.getElementById('single_model');
            if (singleApiType && singleModel) {
                singleApiType.addEventListener('change', function() {
                    updateModelOptions(this.value, singleModel);
                });
                updateModelOptions('deepseek', singleModel);
            }

            // 添加模型配置
            const addModelBtn = document.getElementById('addModelBtn');
            const modelsContainer = document.getElementById('modelsContainer');

            addModelBtn.addEventListener('click', addModelCard);

            function addModelCard() {
                const modelCards = document.querySelectorAll('.model-card');
                if (modelCards.length >= 3) {
                    alert('最多只能添加3个模型');
                    return;
                }

                modelCounter++;
                const cardId = `model_${modelCounter}`;

                const modelCard = document.createElement('div');
                modelCard.className = 'model-card';
                modelCard.setAttribute('data-id', cardId);
                modelCard.innerHTML = `
                    <div class="model-card-header">
                        <div class="model-card-title">
                            <i class="fas fa-robot"></i> 模型 ${modelCounter}
                        </div>
                        <button type="button" class="remove-model-btn" onclick="removeModelCard('${cardId}')">
                            <i class="fas fa-trash"></i> 移除
                        </button>
                    </div>
                    <div class="config-row">
                        <div class="form-group select-wrapper">
                            <label><i class="fas fa-network-wired"></i> 选择API</label>
                            <select id="${cardId}_api_type" required>
                                <option value="deepseek">Deepseek</option>
                                <option value="openai">OpenAI</option>
                                <option value="anthropic">Anthropic</option>
                                <option value="google">Google</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-key"></i> API密钥</label>
                            <input type="password" id="${cardId}_api_key" required placeholder="sk-...">
                        </div>
                    </div>
                    <div class="config-row">
                        <div class="form-group select-wrapper">
                            <label><i class="fas fa-robot"></i> 选择模型</label>
                            <select id="${cardId}_model" required>
                                <option value="deepseek-chat" data-api="deepseek">Deepseek Chat</option>
                                <option value="deepseek-reasoner" data-api="deepseek">Deepseek Reasoner</option>
                                <option value="gpt-4o" data-api="openai">GPT-4</option>
                                <option value="gpt-4.5-preview" data-api="openai">GPT-4.5 Preview</option>
                                <option value="claude-3.7-sonnet-20250219" data-api="anthropic">Claude 3.7 Sonnet</option>
                                <option value="gemini-pro" data-api="google">Gemini Pro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>温度: <span id="${cardId}_temp_value">1.0</span></label>
                            <div class="temperature-slider-container">
                                <input type="range" id="${cardId}_temperature" min="0" max="2" step="0.1" value="1.0" class="temperature-slider">
                                <div class="temperature-marks"><span>0</span><span>1.0</span><span>2.0</span></div>
                            </div>
                        </div>
                    </div>
                `;

                modelsContainer.appendChild(modelCard);

                // 设置温度滑块
                setupSlider(`${cardId}_temperature`, `${cardId}_temp_value`);

                // 设置API联动
                const apiTypeSelect = document.getElementById(`${cardId}_api_type`);
                const modelSelect = document.getElementById(`${cardId}_model`);
                apiTypeSelect.addEventListener('change', function() {
                    updateModelOptions(this.value, modelSelect);
                });
                updateModelOptions('deepseek', modelSelect);

                // 更新按钮状态
                if (modelCards.length + 1 >= 3) {
                    addModelBtn.disabled = true;
                }
            }

            // 移除模型配置（全局函数）
            window.removeModelCard = function(cardId) {
                const card = document.querySelector(`[data-id="${cardId}"]`);
                if (card) {
                    card.remove();
                    addModelBtn.disabled = false;
                }
            };

            // 翻译按钮
            const translateBtn = document.getElementById('translateBtn');
            const userInput = document.getElementById('user_input');
            const resultsArea = document.getElementById('resultsArea');
            const resultsList = document.getElementById('resultsList');
            const compareBtn = document.getElementById('compareBtn');

            translateBtn.addEventListener('click', async function() {
                const userText = userInput.value.trim();
                if (!userText) {
                    alert('请输入需要翻译的内容');
                    return;
                }

                // 清空之前的结果
                resultsList.innerHTML = '';
                translationResults = [];
                resultsArea.style.display = 'block';

                if (currentMode === 'single') {
                    // 单模型翻译
                    const config = {
                        api_type: document.getElementById('single_api_type').value,
                        api_key: document.getElementById('single_api_key').value,
                        model: document.getElementById('single_model').value,
                        temperature: document.getElementById('single_temperature').value,
                        source_lang: document.getElementById('single_source_lang').value,
                        target_lang: document.getElementById('single_target_lang').value,
                        system_prompt: document.getElementById('single_system_prompt').value
                    };

                    const modelName = document.getElementById('single_model').selectedOptions[0].text;
                    await performTranslation(userText, config, modelName);
                    compareBtn.style.display = 'none';
                } else {
                    // 多模型翻译
                    const modelCards = document.querySelectorAll('.model-card');
                    if (modelCards.length === 0) {
                        alert('请至少添加一个模型配置');
                        return;
                    }

                    const sourceLang = document.getElementById('multi_source_lang').value;
                    const targetLang = document.getElementById('multi_target_lang').value;
                    const systemPrompt = document.getElementById('multi_system_prompt').value;

                    // 并发翻译所有模型
                    const promises = [];
                    modelCards.forEach(card => {
                        const cardId = card.getAttribute('data-id');
                        const config = {
                            api_type: document.getElementById(`${cardId}_api_type`).value,
                            api_key: document.getElementById(`${cardId}_api_key`).value,
                            model: document.getElementById(`${cardId}_model`).value,
                            temperature: document.getElementById(`${cardId}_temperature`).value,
                            source_lang: sourceLang,
                            target_lang: targetLang,
                            system_prompt: systemPrompt
                        };

                        const modelName = document.getElementById(`${cardId}_model`).selectedOptions[0].text;
                        promises.push(performTranslation(userText, config, modelName));
                    });

                    await Promise.all(promises);
                    compareBtn.style.display = modelCards.length >= 2 ? 'flex' : 'none';
                }
            });

            // 执行翻译
            async function performTranslation(userText, config, modelName) {
                const resultCard = document.createElement('div');
                resultCard.className = 'result-card';
                resultCard.innerHTML = `
                    <div class="result-card-header">
                        <div class="result-model-name">${modelName}</div>
                        <div class="result-status loading">
                            <i class="fas fa-spinner fa-spin"></i> 翻译中...
                        </div>
                    </div>
                    <div class="result-content" data-model="${modelName}">等待结果...</div>
                `;
                resultsList.appendChild(resultCard);

                try {
                    const response = await fetch('/translate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            user_message: userText,
                            api_type: config.api_type,
                            api_key: config.api_key,
                            model: config.model,
                            temperature: config.temperature,
                            source_lang: config.source_lang,
                            target_lang: config.target_lang,
                            system_prompt: config.system_prompt
                        })
                    });

                    const result = await response.json();
                    const statusEl = resultCard.querySelector('.result-status');
                    const contentEl = resultCard.querySelector('.result-content');

                    if (result.error) {
                        statusEl.className = 'result-status error';
                        statusEl.innerHTML = '<i class="fas fa-exclamation-circle"></i> 失败';
                        contentEl.textContent = `错误: ${result.error}`;
                    } else {
                        statusEl.className = 'result-status success';
                        statusEl.innerHTML = '<i class="fas fa-check-circle"></i> 完成';
                        contentEl.textContent = result.translation;
                        translationResults.push({
                            model: modelName,
                            content: result.translation
                        });
                    }
                } catch (error) {
                    const statusEl = resultCard.querySelector('.result-status');
                    const contentEl = resultCard.querySelector('.result-content');
                    statusEl.className = 'result-status error';
                    statusEl.innerHTML = '<i class="fas fa-exclamation-circle"></i> 失败';
                    contentEl.textContent = `网络错误: ${error.message}`;
                }
            }

            // 横向比较弹窗
            const compareModal = document.getElementById('compareModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const compareModalBody = document.getElementById('compareModalBody');

            compareBtn.addEventListener('click', function() {
                if (translationResults.length < 2) {
                    alert('至少需要2个成功的翻译结果才能进行比较');
                    return;
                }

                // 限制最多显示3个
                const resultsToShow = translationResults.slice(0, 3);

                compareModalBody.innerHTML = `
                    <div class="compare-grid">
                        ${resultsToShow.map(result => `
                            <div class="compare-item">
                                <div class="compare-item-header">${result.model}</div>
                                <div class="compare-item-content">${escapeHtml(result.content)}</div>
                            </div>
                        `).join('')}
                    </div>
                `;

                compareModal.classList.add('active');
            });

            closeModalBtn.addEventListener('click', function() {
                compareModal.classList.remove('active');
            });

            compareModal.addEventListener('click', function(e) {
                if (e.target === compareModal) {
                    compareModal.classList.remove('active');
                }
            });

            function escapeHtml(text) {
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return text.replace(/[&<>"']/g, function(m) { return map[m]; });
            }
        });

        // AI译审页面功能
        document.addEventListener('DOMContentLoaded', function() {
            let currentReviewMode = 'single';
            let expertCounter = 0;

            // 专家角色定义
            const expertRoles = [
                { name: '术语专家', icon: 'fa-book', color: '#3b82f6' },
                { name: '流畅度专家', icon: 'fa-feather', color: '#8b5cf6' },
                { name: '文化适应性专家', icon: 'fa-globe', color: '#ec4899' },
                { name: '准确性专家', icon: 'fa-crosshairs', color: '#10b981' },
                { name: '风格专家', icon: 'fa-palette', color: '#f59e0b' },
                { name: '语法专家', icon: 'fa-spell-check', color: '#ef4444' }
            ];

            // 模式切换
            const reviewModeBtns = document.querySelectorAll('[data-review-mode]');
            const singleReviewConfig = document.getElementById('singleReviewConfig');
            const dualReviewConfig = document.getElementById('dualReviewConfig');
            const twoStageReviewConfig = document.getElementById('twoStageReviewConfig');
            const meetingReviewConfig = document.getElementById('meetingReviewConfig');

            reviewModeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const mode = this.getAttribute('data-review-mode');
                    currentReviewMode = mode;

                    reviewModeBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    singleReviewConfig.style.display = 'none';
                    dualReviewConfig.style.display = 'none';
                    twoStageReviewConfig.style.display = 'none';
                    meetingReviewConfig.style.display = 'none';

                    if (mode === 'single') {
                        singleReviewConfig.style.display = 'block';
                    } else if (mode === 'dual') {
                        dualReviewConfig.style.display = 'block';
                    } else if (mode === 'two-stage') {
                        twoStageReviewConfig.style.display = 'block';
                    } else if (mode === 'meeting') {
                        meetingReviewConfig.style.display = 'block';
                        // 自动添加3个专家
                        const expertCards = document.querySelectorAll('.expert-card');
                        if (expertCards.length === 0) {
                            for (let i = 0; i < 3; i++) {
                                addExpertCard();
                            }
                        }
                    }
                });
            });

            // API联动配置
            const reviewSingleApiType = document.getElementById('review_single_api_type');
            const reviewSingleModel = document.getElementById('review_single_model');
            if (reviewSingleApiType && reviewSingleModel) {
                reviewSingleApiType.addEventListener('change', function() {
                    updateModelOptions(this.value, reviewSingleModel);
                });
                updateModelOptions('deepseek', reviewSingleModel);
            }

            const reviewDualApiType1 = document.getElementById('review_dual_api_type1');
            const reviewDualModel1 = document.getElementById('review_dual_model1');
            if (reviewDualApiType1 && reviewDualModel1) {
                reviewDualApiType1.addEventListener('change', function() {
                    updateModelOptions(this.value, reviewDualModel1);
                });
                updateModelOptions('deepseek', reviewDualModel1);
            }

            const reviewDualApiType2 = document.getElementById('review_dual_api_type2');
            const reviewDualModel2 = document.getElementById('review_dual_model2');
            if (reviewDualApiType2 && reviewDualModel2) {
                reviewDualApiType2.addEventListener('change', function() {
                    updateModelOptions(this.value, reviewDualModel2);
                });
                updateModelOptions('deepseek', reviewDualModel2);
            }

            const reviewScanApiType = document.getElementById('review_scan_api_type');
            const reviewScanModel = document.getElementById('review_scan_model');
            if (reviewScanApiType && reviewScanModel) {
                reviewScanApiType.addEventListener('change', function() {
                    updateModelOptions(this.value, reviewScanModel);
                });
                updateModelOptions('deepseek', reviewScanModel);
            }

            const reviewCalibrationApiType = document.getElementById('review_calibration_api_type');
            const reviewCalibrationModel = document.getElementById('review_calibration_model');
            if (reviewCalibrationApiType && reviewCalibrationModel) {
                reviewCalibrationApiType.addEventListener('change', function() {
                    updateModelOptions(this.value, reviewCalibrationModel);
                });
                updateModelOptions('deepseek', reviewCalibrationModel);
            }

            const genreSelect = document.getElementById('review_genre');
            const fewShotTextarea = document.getElementById('review_few_shot');
            const promptPreview = document.getElementById('review_prompt_preview');
            const fewShotTemplates = {
                '通用': `示例1：{"error_text":"译文片段","index":12,"category":"accuracy","suggestion":"更正译法","reason":"语义偏差"}\n示例2：{"error_text":"术语A","index":45,"category":"terminology","suggestion":"统一译为术语B","reason":"术语不一致"}`,
                '法律': `示例1：{"error_text":"shall be liable","index":32,"category":"accuracy","suggestion":"应承担责任","reason":"法律责任义务误译"}\n示例2：{"error_text":"party A","index":58,"category":"terminology","suggestion":"甲方","reason":"法律主体称谓不统一"}`,
                '医学': `示例1：{"error_text":"dosage","index":20,"category":"terminology","suggestion":"剂量","reason":"医学术语误译"}\n示例2：{"error_text":"adverse event","index":71,"category":"accuracy","suggestion":"不良事件","reason":"专业语义偏差"}`,
                '文学': `示例1：{"error_text":"moonlight","index":15,"category":"style","suggestion":"月光","reason":"意象表达不够诗性"}\n示例2：{"error_text":"he whispered","index":49,"category":"fluency","suggestion":"他低声呢喃","reason":"节奏不够自然"}`,
                '科技': `示例1：{"error_text":"throughput","index":27,"category":"terminology","suggestion":"吞吐量","reason":"技术术语规范性"}\n示例2：{"error_text":"latency","index":64,"category":"accuracy","suggestion":"延迟","reason":"指标表达不准确"}`,
                '市场营销': `示例1：{"error_text":"value proposition","index":19,"category":"terminology","suggestion":"价值主张","reason":"营销术语不一致"}\n示例2：{"error_text":"call to action","index":88,"category":"style","suggestion":"行动号召","reason":"营销语气不够明确"}`
            };

            function updatePromptPreview() {
                if (!promptPreview) return;
                const genre = genreSelect ? genreSelect.value : '通用';
                const fewShotContent = fewShotTextarea ? fewShotTextarea.value.trim() : '';
                promptPreview.textContent = `体裁：${genre}\n\nJSON输出结构预览：\n{\n  "summary": "...",\n  "errors": [\n    {\n      "error_text": "...",\n      "index": 0,\n      "category": "accuracy/fluency/terminology/style/logic/consistency/omission/addition",\n      "suggestion": "...",\n      "reason": "..."\n    }\n  ],\n  "consistency_notes": "...",\n  "final_suggestion": "..."\n}\n\nFew-shot 示例：\n${fewShotContent || '（将使用默认模板）'}`;
            }

            if (genreSelect && fewShotTextarea) {
                fewShotTextarea.value = fewShotTemplates[genreSelect.value] || fewShotTemplates['通用'];
                updatePromptPreview();
                genreSelect.addEventListener('change', function() {
                    fewShotTextarea.value = fewShotTemplates[this.value] || fewShotTemplates['通用'];
                    updatePromptPreview();
                });
                fewShotTextarea.addEventListener('input', updatePromptPreview);
            }

            // 添加专家
            const addExpertBtn = document.getElementById('addExpertBtn');
            const meetingModelsContainer = document.getElementById('meetingModelsContainer');

            addExpertBtn.addEventListener('click', addExpertCard);

            function addExpertCard() {
                const expertCards = document.querySelectorAll('.expert-card');
                if (expertCards.length >= 6) {
                    alert('最多可以添加6个专家');
                    return;
                }

                expertCounter++;
                const cardId = `expert_${expertCounter}`;
                const role = expertRoles[(expertCounter - 1) % expertRoles.length];

                const expertCard = document.createElement('div');
                expertCard.className = 'expert-card';
                expertCard.setAttribute('data-id', cardId);
                expertCard.innerHTML = `
                    <div class="expert-card-header">
                        <div class="expert-role-badge" style="background: ${role.color};">
                            <i class="fas ${role.icon}"></i> ${role.name}
                        </div>
                        <button type="button" class="remove-model-btn" onclick="removeExpertCard('${cardId}')">
                            <i class="fas fa-trash"></i> 移除
                        </button>
                    </div>
                    <div class="expert-config-grid">
                        <div class="form-group select-wrapper">
                            <label>API</label>
                            <select id="${cardId}_api_type">
                                <option value="deepseek">Deepseek</option>
                                <option value="openai">OpenAI</option>
                                <option value="anthropic">Anthropic</option>
                                <option value="google">Google</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>API密钥</label>
                            <input type="password" id="${cardId}_api_key" placeholder="sk-...">
                        </div>
                        <div class="form-group select-wrapper">
                            <label>模型</label>
                            <select id="${cardId}_model">
                                <option value="deepseek-chat" data-api="deepseek">Deepseek Chat</option>
                                <option value="deepseek-reasoner" data-api="deepseek">Deepseek Reasoner</option>
                                <option value="gpt-4o" data-api="openai">GPT-4</option>
                                <option value="gpt-4.5-preview" data-api="openai">GPT-4.5 Preview</option>
                                <option value="claude-3.7-sonnet-20250219" data-api="anthropic">Claude 3.7 Sonnet</option>
                                <option value="gemini-pro" data-api="google">Gemini Pro</option>
                            </select>
                        </div>
                    </div>
                `;

                meetingModelsContainer.appendChild(expertCard);

                // 设置API联动
                const apiTypeSelect = document.getElementById(`${cardId}_api_type`);
                const modelSelect = document.getElementById(`${cardId}_model`);
                apiTypeSelect.addEventListener('change', function() {
                    updateModelOptions(this.value, modelSelect);
                });
                updateModelOptions('deepseek', modelSelect);
            }

            window.removeExpertCard = function(cardId) {
                const card = document.querySelector(`[data-id="${cardId}"]`);
                if (card) {
                    card.remove();
                }
            };

            // 开始译审
            const startReviewBtn = document.getElementById('startReviewBtn');
            const reviewResultsArea = document.getElementById('reviewResultsArea');
            const reviewResultsContent = document.getElementById('reviewResultsContent');

            startReviewBtn.addEventListener('click', async function() {
                const sourceText = document.getElementById('review_source_text').value.trim();
                const targetText = document.getElementById('review_target_text').value.trim();
                const sourceLang = document.getElementById('review_source_lang').value;
                const targetLang = document.getElementById('review_target_lang').value;

                if (!sourceText || !targetText) {
                    alert('请输入原文和译文');
                    return;
                }

                reviewResultsContent.innerHTML = '';
                reviewResultsArea.style.display = 'block';

                // 显示加载状态
                reviewResultsContent.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 48px; color: var(--primary-color);"></i>
                        <p style="margin-top: 20px; color: var(--text-secondary);">正在进行译审，请稍候...</p>
                    </div>
                `;

                if (currentReviewMode === 'single') {
                    await performSingleReview(sourceText, targetText, sourceLang, targetLang);
                } else if (currentReviewMode === 'dual') {
                    await performDualReview(sourceText, targetText, sourceLang, targetLang);
                } else if (currentReviewMode === 'two-stage') {
                    await performTwoStageReview(sourceText, targetText, sourceLang, targetLang);
                } else if (currentReviewMode === 'meeting') {
                    await performMeetingReview(sourceText, targetText, sourceLang, targetLang);
                }
            });

            // 单模型译审
            async function performSingleReview(sourceText, targetText, sourceLang, targetLang) {
                const config = {
                    api_type: document.getElementById('review_single_api_type').value,
                    api_key: document.getElementById('review_single_api_key').value,
                    model: document.getElementById('review_single_model').value
                };

                const modelName = document.getElementById('review_single_model').selectedOptions[0].text;

                try {
                    const response = await fetch('/review', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            mode: 'single',
                            source_text: sourceText,
                            target_text: targetText,
                            source_lang: sourceLang,
                            target_lang: targetLang,
                            config: config
                        })
                    });

                    const result = await response.json();

                    if (result.error) {
                        reviewResultsContent.innerHTML = `
                            <div class="review-result-card" style="background: #fee2e2; border-color: #fecaca;">
                                <p style="color: #991b1b;"><i class="fas fa-exclamation-circle"></i> ${result.error}</p>
                            </div>
                        `;
                    } else {
                        displaySingleReviewResult(result, modelName);
                    }
                } catch (error) {
                    reviewResultsContent.innerHTML = `
                        <div class="review-result-card" style="background: #fee2e2; border-color: #fecaca;">
                            <p style="color: #991b1b;"><i class="fas fa-exclamation-circle"></i> 网络错误: ${error.message}</p>
                        </div>
                    `;
                }
            }

            function displaySingleReviewResult(result, modelName) {
                reviewResultsContent.innerHTML = `
                    <div class="review-result-card">
                        <div class="review-result-header">
                            <div class="review-result-title">
                                <i class="fas fa-robot"></i> ${modelName}
                            </div>
                            <div class="review-score">
                                <i class="fas fa-star"></i> ${result.score || 'N/A'}
                            </div>
                        </div>
                        <div class="review-content-section">
                            <div class="review-section-label">
                                <i class="fas fa-clipboard-list"></i> 评估内容
                            </div>
                            <div class="review-section-content">${escapeHtml(result.review)}</div>
                        </div>
                        ${result.suggestions ? `
                        <div class="review-content-section">
                            <div class="review-section-label">
                                <i class="fas fa-lightbulb"></i> 改进建议
                            </div>
                            <div class="review-section-content">${escapeHtml(result.suggestions)}</div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }

            // 双模型对比
            async function performDualReview(sourceText, targetText, sourceLang, targetLang) {
                const config1 = {
                    api_type: document.getElementById('review_dual_api_type1').value,
                    api_key: document.getElementById('review_dual_api_key1').value,
                    model: document.getElementById('review_dual_model1').value
                };

                const config2 = {
                    api_type: document.getElementById('review_dual_api_type2').value,
                    api_key: document.getElementById('review_dual_api_key2').value,
                    model: document.getElementById('review_dual_model2').value
                };

                const modelName1 = document.getElementById('review_dual_model1').selectedOptions[0].text;
                const modelName2 = document.getElementById('review_dual_model2').selectedOptions[0].text;

                try {
                    const response = await fetch('/review', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            mode: 'dual',
                            source_text: sourceText,
                            target_text: targetText,
                            source_lang: sourceLang,
                            target_lang: targetLang,
                            config1: config1,
                            config2: config2
                        })
                    });

                    const result = await response.json();

                    if (result.error) {
                        reviewResultsContent.innerHTML = `
                            <div class="review-result-card" style="background: #fee2e2; border-color: #fecaca;">
                                <p style="color: #991b1b;"><i class="fas fa-exclamation-circle"></i> ${result.error}</p>
                            </div>
                        `;
                    } else {
                        displayDualReviewResult(result, modelName1, modelName2);
                    }
                } catch (error) {
                    reviewResultsContent.innerHTML = `
                        <div class="review-result-card" style="background: #fee2e2; border-color: #fecaca;">
                            <p style="color: #991b1b;"><i class="fas fa-exclamation-circle"></i> 网络错误: ${error.message}</p>
                        </div>
                    `;
                }
            }

            function displayDualReviewResult(result, modelName1, modelName2) {
                reviewResultsContent.innerHTML = `
                    <div class="dual-comparison-grid">
                        <div class="review-result-card">
                            <div class="review-result-header">
                                <div class="review-result-title">
                                    <i class="fas fa-robot"></i> ${modelName1}
                                </div>
                                <div class="review-score">
                                    <i class="fas fa-star"></i> ${result.review1.score || 'N/A'}
                                </div>
                            </div>
                            <div class="review-content-section">
                                <div class="review-section-label">
                                    <i class="fas fa-clipboard-list"></i> 评估内容
                                </div>
                                <div class="review-section-content">${escapeHtml(result.review1.review)}</div>
                            </div>
                            ${result.review1.suggestions ? `
                            <div class="review-content-section">
                                <div class="review-section-label">
                                    <i class="fas fa-lightbulb"></i> 改进建议
                                </div>
                                <div class="review-section-content">${escapeHtml(result.review1.suggestions)}</div>
                            </div>
                            ` : ''}
                        </div>
                        <div class="review-result-card">
                            <div class="review-result-header">
                                <div class="review-result-title">
                                    <i class="fas fa-robot"></i> ${modelName2}
                                </div>
                                <div class="review-score">
                                    <i class="fas fa-star"></i> ${result.review2.score || 'N/A'}
                                </div>
                            </div>
                            <div class="review-content-section">
                                <div class="review-section-label">
                                    <i class="fas fa-clipboard-list"></i> 评估内容
                                </div>
                                <div class="review-section-content">${escapeHtml(result.review2.review)}</div>
                            </div>
                            ${result.review2.suggestions ? `
                            <div class="review-content-section">
                                <div class="review-section-label">
                                    <i class="fas fa-lightbulb"></i> 改进建议
                                </div>
                                <div class="review-section-content">${escapeHtml(result.review2.suggestions)}</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                    ${result.comparison ? `
                    <div class="final-consensus-card" style="margin-top: 20px;">
                        <div class="consensus-header">
                            <i class="fas fa-balance-scale"></i> 对比分析
                        </div>
                        <div class="consensus-content">${escapeHtml(result.comparison)}</div>
                    </div>
                    ` : ''}
                `;
            }

            // 双阶段译审
            async function performTwoStageReview(sourceText, targetText, sourceLang, targetLang) {
                const scanConfig = {
                    api_type: document.getElementById('review_scan_api_type').value,
                    api_key: document.getElementById('review_scan_api_key').value,
                    model: document.getElementById('review_scan_model').value
                };

                const calibrationConfig = {
                    api_type: document.getElementById('review_calibration_api_type').value,
                    api_key: document.getElementById('review_calibration_api_key').value,
                    model: document.getElementById('review_calibration_model').value
                };

                const genre = document.getElementById('review_genre').value;
                const fewShot = document.getElementById('review_few_shot').value.trim();
                const humanNotes = document.getElementById('review_human_notes').value.trim();

                const scanModelName = document.getElementById('review_scan_model').selectedOptions[0].text;
                const calibrationModelName = document.getElementById('review_calibration_model').selectedOptions[0].text;

                try {
                    const response = await fetch('/review', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            mode: 'two-stage',
                            source_text: sourceText,
                            target_text: targetText,
                            source_lang: sourceLang,
                            target_lang: targetLang,
                            genre: genre,
                            few_shot: fewShot,
                            human_notes: humanNotes,
                            scan_config: scanConfig,
                            calibration_config: calibrationConfig
                        })
                    });

                    const result = await response.json();

                    if (result.error) {
                        reviewResultsContent.innerHTML = `
                            <div class="review-result-card" style="background: #fee2e2; border-color: #fecaca;">
                                <p style="color: #991b1b;"><i class="fas fa-exclamation-circle"></i> ${result.error}</p>
                            </div>
                        `;
                    } else {
                        displayTwoStageReviewResult(result, scanModelName, calibrationModelName);
                    }
                } catch (error) {
                    reviewResultsContent.innerHTML = `
                        <div class="review-result-card" style="background: #fee2e2; border-color: #fecaca;">
                            <p style="color: #991b1b;"><i class="fas fa-exclamation-circle"></i> 网络错误: ${error.message}</p>
                        </div>
                    `;
                }
            }

            function displayTwoStageReviewResult(result, scanModelName, calibrationModelName) {
                reviewResultsContent.innerHTML = `
                    <div class="review-result-card">
                        <div class="review-result-header">
                            <div class="review-result-title">
                                <i class="fas fa-bolt"></i> 初筛扫描：${scanModelName}
                            </div>
                            <div class="review-score">
                                <i class="fas fa-flag"></i> Stage 1
                            </div>
                        </div>
                        <div class="review-content-section">
                            <div class="review-section-label">
                                <i class="fas fa-code"></i> JSON 输出
                            </div>
                            <div class="json-output">${escapeHtml(result.scan_output)}</div>
                        </div>
                    </div>
                    <div class="review-result-card">
                        <div class="review-result-header">
                            <div class="review-result-title">
                                <i class="fas fa-brain"></i> 深度校准：${calibrationModelName}
                            </div>
                            <div class="review-score">
                                <i class="fas fa-flag-checkered"></i> Stage 2
                            </div>
                        </div>
                        <div class="review-content-section">
                            <div class="review-section-label">
                                <i class="fas fa-code"></i> 结构化结论
                            </div>
                            <div class="json-output">${escapeHtml(result.calibration_output)}</div>
                        </div>
                    </div>
                `;
            }

            // 模型开会
            async function performMeetingReview(sourceText, targetText, sourceLang, targetLang) {
                const expertCards = document.querySelectorAll('.expert-card');
                if (expertCards.length < 3) {
                    alert('模型开会模式至少需要3个专家');
                    return;
                }

                const experts = [];
                expertCards.forEach((card, index) => {
                    const cardId = card.getAttribute('data-id');
                    const role = expertRoles[index % expertRoles.length];
                    experts.push({
                        role: role.name,
                        icon: role.icon,
                        config: {
                            api_type: document.getElementById(`${cardId}_api_type`).value,
                            api_key: document.getElementById(`${cardId}_api_key`).value,
                            model: document.getElementById(`${cardId}_model`).value
                        }
                    });
                });

                try {
                    const response = await fetch('/review', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            mode: 'meeting',
                            source_text: sourceText,
                            target_text: targetText,
                            source_lang: sourceLang,
                            target_lang: targetLang,
                            experts: experts
                        })
                    });

                    const result = await response.json();

                    if (result.error) {
                        reviewResultsContent.innerHTML = `
                            <div class="review-result-card" style="background: #fee2e2; border-color: #fecaca;">
                                <p style="color: #991b1b;"><i class="fas fa-exclamation-circle"></i> ${result.error}</p>
                            </div>
                        `;
                    } else {
                        displayMeetingReviewResult(result);
                    }
                } catch (error) {
                    reviewResultsContent.innerHTML = `
                        <div class="review-result-card" style="background: #fee2e2; border-color: #fecaca;">
                            <p style="color: #991b1b;"><i class="fas fa-exclamation-circle"></i> 网络错误: ${error.message}</p>
                        </div>
                    `;
                }
            }

            function displayMeetingReviewResult(result) {
                let timelineHTML = '<div class="meeting-result-timeline">';

                if (result.opinions && result.opinions.length > 0) {
                    result.opinions.forEach(opinion => {
                        timelineHTML += `
                            <div class="timeline-item">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-expert-name">
                                        <i class="fas ${opinion.icon || 'fa-user'}"></i> ${opinion.role}
                                    </div>
                                    <div class="timeline-opinion">${escapeHtml(opinion.opinion)}</div>
                                </div>
                            </div>
                        `;
                    });
                }

                timelineHTML += '</div>';

                reviewResultsContent.innerHTML = `
                    <div class="review-result-card">
                        <div class="review-result-header">
                            <div class="review-result-title">
                                <i class="fas fa-users"></i> 专家团队评审
                            </div>
                            ${result.final_score ? `
                            <div class="review-score">
                                <i class="fas fa-trophy"></i> ${result.final_score}
                            </div>
                            ` : ''}
                        </div>
                        <h4 style="margin: 16px 0 12px 0; color: var(--text-primary); font-size: 1rem;">
                            <i class="fas fa-comments"></i> 专家意见
                        </h4>
                        ${timelineHTML}
                    </div>
                    ${result.consensus ? `
                    <div class="final-consensus-card">
                        <div class="consensus-header">
                            <i class="fas fa-gavel"></i> 最终共识（民主表决结果）
                        </div>
                        <div class="consensus-content">${escapeHtml(result.consensus)}</div>
                    </div>
                    ` : ''}
                `;
            }

            function escapeHtml(text) {
                if (!text) return '';
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return text.replace(/[&<>"']/g, function(m) { return map[m]; });
            }
        });
    </script>
</body>
</html>
